<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tablas de Verdad</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500;600&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f4f6f9;--surface:#fff;--border:#dde3ed;--border2:#c8d0e0;
  --blue:#2563eb;--blue-l:#eff4ff;--blue-m:#bfcfff;
  --grey:#64748b;--grey-l:#94a3b8;--text:#1e2a3a;--text2:#374151;
  --green:#059669;--green-bg:#ecfdf5;
  --red:#dc2626;--red-bg:#fef2f2;
  --amber:#d97706;--amber-bg:#fffbeb;
  --purple:#7c3aed;--purple-l:#f5f3ff;--purple-m:#ddd6fe;
  --r:10px;--sh:0 1px 4px rgba(30,42,58,.07),0 2px 12px rgba(30,42,58,.05);
}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;font-size:15px;line-height:1.5}
.page{max-width:820px;margin:0 auto;padding:2.5rem 1.25rem 4rem}

/* Header */
.ph{margin-bottom:2rem;padding-bottom:1.25rem;border-bottom:1px solid var(--border)}
.pt{font-size:1.3rem;font-weight:600;letter-spacing:-.02em}
.ps{font-size:.75rem;color:var(--grey-l);margin-top:.2rem;font-family:'DM Mono',monospace}

/* Card */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--sh);margin-bottom:1rem}
.ch{padding:.85rem 1.2rem;border-bottom:1px solid var(--border)}
.cl{font-size:.68rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--grey-l);font-family:'DM Mono',monospace}
.cb{padding:1.2rem}

/* Tabs */
.tab-row{display:grid;grid-template-columns:1fr 1fr;gap:.6rem;padding:1.2rem}
.tab-btn{background:var(--bg);border:1.5px solid var(--border);border-radius:8px;padding:.9rem 1rem;cursor:pointer;text-align:left;transition:all .15s;font-family:'DM Sans',sans-serif}
.tab-btn:hover{border-color:var(--blue-m);background:var(--blue-l)}
.tab-btn.active{border-color:var(--blue);background:var(--blue-l);box-shadow:0 0 0 3px rgba(37,99,235,.1)}
.tn{font-size:.67rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--blue);font-family:'DM Mono',monospace;margin-bottom:.3rem}
.tf{font-size:.8rem;font-family:'DM Mono',monospace;color:var(--text2);line-height:1.7}

/* Builder */
.bb{padding:1.2rem}
.bh{font-size:.68rem;font-weight:600;letter-spacing:.1em;text-transform:uppercase;color:var(--grey-l);font-family:'DM Mono',monospace;margin-bottom:.9rem}

/* Fila de fórmula */
.frow{display:flex;flex-wrap:wrap;align-items:center;gap:.28rem;padding:.65rem .85rem;background:var(--bg);border:1px solid var(--border);border-radius:8px;margin-bottom:.9rem;min-height:3rem}

/* Grupo sub-fórmula: [¬-btn] ( lit OP lit ) */
.grp{display:flex;align-items:center;gap:.22rem}

/* Botón ¬ de grupo */
.gneg{font-family:'DM Mono',monospace;font-size:.82rem;background:none;border:1.5px solid var(--border);border-radius:5px;padding:.2rem .4rem;cursor:pointer;color:var(--grey-l);transition:all .15s;line-height:1;white-space:nowrap}
.gneg:hover{background:var(--purple-l);border-color:var(--purple-m);color:var(--purple)}
.gneg.on{background:var(--purple-l);border-color:var(--purple-m);color:var(--purple);font-weight:700}
.gneg-hint{font-size:.62rem;color:var(--grey-l);margin-right:.05rem;font-family:'DM Mono',monospace;user-select:none}

/* Paren */
.tp{font-family:'DM Mono',monospace;font-size:1rem;color:var(--grey-l);padding:0 .04rem;user-select:none}

/* Literal token */
.lw{display:flex;align-items:center}
.lb{font-family:'DM Mono',monospace;font-size:.85rem;background:none;border:1.5px solid var(--border);border-right:none;border-radius:5px 0 0 5px;padding:.2rem .3rem;cursor:pointer;color:var(--grey-l);transition:all .15s;line-height:1;height:1.8rem}
.lb:hover{background:var(--blue-l);border-color:var(--blue-m);color:var(--blue)}
.lb.on{background:var(--blue-l);border-color:var(--blue-m);color:var(--blue);font-weight:700}
.ll{font-family:'DM Mono',monospace;font-size:.88rem;font-weight:500;padding:.2rem .45rem;border:1.5px solid var(--border);border-radius:0 5px 5px 0;color:var(--text);background:#fff;user-select:none;height:1.8rem;display:flex;align-items:center}

/* Op select */
.ow{position:relative;display:flex;align-items:center}
.osel{appearance:none;background:#fff;border:1.5px solid var(--blue-m);border-radius:6px;padding:.2rem 1.5rem .2rem .5rem;font-family:'DM Mono',monospace;font-size:.92rem;color:var(--blue);font-weight:500;cursor:pointer;outline:none;transition:all .15s;height:1.8rem}
.osel:hover,.osel:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
.ow::after{content:'▾';position:absolute;right:.36rem;color:var(--blue);pointer-events:none;font-size:.6rem;top:50%;transform:translateY(-50%)}

/* Op principal (entre grupos) */
.osel-main{appearance:none;background:#fff;border:2px solid var(--blue);border-radius:7px;padding:.2rem 1.6rem .2rem .6rem;font-family:'DM Mono',monospace;font-size:1rem;color:var(--blue);font-weight:600;cursor:pointer;outline:none;transition:all .15s;height:1.9rem}
.osel-main:hover,.osel-main:focus{background:var(--blue-l);box-shadow:0 0 0 3px rgba(37,99,235,.15)}
.ow-main{position:relative;display:flex;align-items:center}
.ow-main::after{content:'▾';position:absolute;right:.38rem;color:var(--blue);pointer-events:none;font-size:.6rem;top:50%;transform:translateY(-50%)}

/* Legend */
.legend{display:flex;flex-wrap:wrap;gap:.35rem;margin-top:.2rem}
.leg{display:flex;align-items:center;gap:.28rem;background:var(--bg);border:1px solid var(--border);border-radius:5px;padding:.17rem .5rem;font-size:.71rem}
.ls{font-family:'DM Mono',monospace;font-weight:600;color:var(--blue)}
.ln{color:var(--grey);font-size:.68rem}
.leg.leg-neg .ls{color:var(--purple)}

/* Preview */
.pbox{font-family:'DM Mono',monospace;font-size:.85rem;padding:.65rem .85rem;background:var(--bg);border:1px solid var(--border);border-radius:7px;color:var(--text2);margin-bottom:.8rem;min-height:2.3rem;word-break:break-all;line-height:1.9}
.pv-v{color:#2563eb;font-weight:500}
.pv-n{color:#7c3aed}
.pv-o{color:#0891b2;font-weight:600}
.pv-p{color:var(--grey-l)}
.pv-gn{color:#7c3aed;font-weight:700}

.err{display:none;align-items:center;gap:.45rem;background:var(--red-bg);border:1px solid #fca5a5;border-radius:7px;padding:.55rem .8rem;font-size:.78rem;color:var(--red);margin-bottom:.8rem}
.err.show{display:flex}

.btn-go{width:100%;background:var(--blue);color:#fff;border:none;border-radius:8px;padding:.72rem;font-family:'DM Sans',sans-serif;font-size:.88rem;font-weight:600;cursor:pointer;transition:all .15s;letter-spacing:-.01em}
.btn-go:hover{background:#1d4ed8;transform:translateY(-1px);box-shadow:0 4px 16px rgba(37,99,235,.25)}
.btn-go:active{transform:translateY(0)}

/* Resultado */
.rc{display:none;margin-top:1rem}
.badge{display:inline-flex;align-items:center;gap:.35rem;border-radius:6px;padding:.3rem .7rem;font-size:.78rem;font-weight:600;margin-bottom:1.1rem;font-family:'DM Mono',monospace}
.bt{background:var(--green-bg);color:var(--green);border:1px solid #a7f3d0}
.bc{background:var(--amber-bg);color:var(--amber);border:1px solid #fde68a}
.bx{background:var(--red-bg);color:var(--red);border:1px solid #fca5a5}

.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:.78rem;font-family:'DM Mono',monospace}
thead tr{border-bottom:2px solid var(--border2)}
th{padding:.5rem .65rem;text-align:center;font-size:.65rem;letter-spacing:.05em;font-weight:600;color:var(--grey);text-transform:uppercase;white-space:nowrap}
th.thr{color:var(--blue);border-left:2px solid var(--border2)}
td{padding:.4rem .65rem;text-align:center;border-bottom:1px solid var(--border)}
td.tdr{border-left:2px solid var(--border2);font-weight:700;font-size:.83rem}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(37,99,235,.02)}
.vT{color:var(--green)}.vF{color:var(--red)}
.tdr.vT{background:#f0fdf9}.tdr.vF{background:#fff5f5}
.rsep td{border-top:1.5px solid var(--border2)!important}

@media(max-width:560px){
  .tab-row{grid-template-columns:1fr}
  th,td{padding:.35rem .38rem;font-size:.7rem}
  .frow{gap:.2rem}
}
</style>
</head>
<body>
<div class="page">

  <div class="ph">
    <div class="pt">Tablas de Verdad</div>
    <div class="ps">// lógica proposicional · p, q, r</div>
  </div>

  <!-- Selección -->
  <div class="card">
    <div class="ch"><span class="cl">Selecciona la proposición</span></div>
    <div class="tab-row">
      <button class="tab-btn active" id="tab1" onclick="selectProp(1)">
        <div class="tn">Proposición 1</div>
        <div class="tf">( A  OP  B )  OP  ( C  OP  D )<br><span style="font-size:.72rem;color:#94a3b8">puedes negar variables y/o grupos</span></div>
      </button>
      <button class="tab-btn" id="tab2" onclick="selectProp(2)">
        <div class="tn">Proposición 2</div>
        <div class="tf">(( A  OP  B )  OP  ( C  OP  D ))<br><span style="font-size:.72rem;color:#94a3b8">puedes negar variables y/o grupos</span></div>
      </button>
    </div>
  </div>

  <!-- Constructor -->
  <div class="card">
    <div class="ch"><span class="cl">Configura la fórmula</span></div>
    <div class="bb">
      <div class="bh">¬ azul = negar variable &nbsp;·&nbsp; ¬(...) morado = negar grupo completo &nbsp;·&nbsp; selector = operador</div>

      <div id="b1"><div class="frow" id="row1"></div></div>
      <div id="b2" style="display:none"><div class="frow" id="row2"></div></div>

      <div class="legend">
        <div class="leg"><span class="ls">∧</span><span class="ln">conjunción</span></div>
        <div class="leg"><span class="ls">∨</span><span class="ln">disyunción</span></div>
        <div class="leg"><span class="ls">→</span><span class="ln">condicional</span></div>
        <div class="leg"><span class="ls">↔</span><span class="ln">bicondicional</span></div>
        <div class="leg"><span class="ls">¬v</span><span class="ln">negar variable</span></div>
        <div class="leg leg-neg"><span class="ls">¬( )</span><span class="ln">negar subgrupo</span></div>
      </div>
    </div>
  </div>

  <!-- Preview + botón -->
  <div class="card">
    <div class="ch"><span class="cl">Fórmula resultante</span></div>
    <div class="cb">
      <div class="pbox" id="preview">—</div>
      <div class="err" id="err"><span>⚠</span><span id="errt"></span></div>
      <button class="btn-go" onclick="calcular()">Calcular tabla de verdad →</button>
    </div>
  </div>

  <!-- Resultado -->
  <div class="rc card" id="rc">
    <div class="ch"><span class="cl">Resultado</span></div>
    <div class="cb">
      <div id="bw"></div>
      <div class="tw"><table id="tbl"></table></div>
    </div>
  </div>

</div>
<script>
// ── Estado ─────────────────────────────────────────────────────────────────
// Estructura fija:
//   Prop 1:  [¬G0?]( [¬L0?]p  OP0  [¬L1?]q ) OP1 [¬G1?]( [¬L2?]q  OP2  [¬L3?]r )
//   Prop 2: ([¬G0?]( [¬L0?]p  OP0  [¬L1?]q ) OP1 [¬G1?]( [¬L2?]q  OP2  [¬L3?]r ))
//
// negL[pi][li] = negar literal li
// negG[pi][gi] = negar grupo gi (0=izq, 1=der)
// ops[pi][oi]  = operador oi

const BASE = ['p','q','q','r'];

const negL = [
  [false,true,true,true],   // prop1 default
  [false,true,true,false],  // prop2 default
];
const negG = [
  [false,false],
  [false,false],
];
const ops = [
  ['∧','∧','∧'],
  ['∧','∧','∧'],
];

let curP = 1;

const OPF = {'∧':(a,b)=>a&&b,'∨':(a,b)=>a||b,'→':(a,b)=>!a||b,'↔':(a,b)=>a===b};
const OPTS = ['∧','∨','→','↔'];

// ── Render ──────────────────────────────────────────────────────────────────
function renderBoth(){ renderRow(1); renderRow(2); }

function renderRow(p){
  const pi=p-1;
  const row=document.getElementById('row'+p);
  row.innerHTML='';

  if(p===2){ const s=document.createElement('span'); s.className='tp'; s.textContent='('; row.appendChild(s); }

  // Grupo izquierdo
  row.appendChild(makeGroup(pi,0));

  // Operador principal
  row.appendChild(makeOp(pi,1,true));

  // Grupo derecho
  row.appendChild(makeGroup(pi,1));

  if(p===2){ const s=document.createElement('span'); s.className='tp'; s.textContent=')'; row.appendChild(s); }
}

function makeGroup(pi,gi){
  // li = 0,1 para gi=0 ; li = 2,3 para gi=1
  const li0=gi*2, li1=gi*2+1;
  const wrap=document.createElement('div');
  wrap.className='grp';

  // Botón ¬ del grupo
  const gnBtn=document.createElement('button');
  gnBtn.className='gneg'+(negG[pi][gi]?' on':'');
  gnBtn.title='Negar toda la subfórmula entre paréntesis';
  gnBtn.innerHTML='<span class="gneg-hint">¬</span>(…)';
  gnBtn.onclick=()=>{ negG[pi][gi]=!negG[pi][gi]; gnBtn.classList.toggle('on',negG[pi][gi]); updatePreview(); clearResult(); };

  // Paren apertura
  const pa=document.createElement('span'); pa.className='tp'; pa.textContent='(';

  // Literal 0 del grupo
  const lit0=makeLit(pi,li0);

  // Operador interno
  const opW=makeOp(pi, gi===0?0:2, false);

  // Literal 1 del grupo
  const lit1=makeLit(pi,li1);

  // Paren cierre
  const pc=document.createElement('span'); pc.className='tp'; pc.textContent=')';

  wrap.appendChild(gnBtn);
  wrap.appendChild(pa);
  wrap.appendChild(lit0);
  wrap.appendChild(opW);
  wrap.appendChild(lit1);
  wrap.appendChild(pc);
  return wrap;
}

function makeLit(pi,li){
  const w=document.createElement('div'); w.className='lw';
  const b=document.createElement('button');
  b.className='lb'+(negL[pi][li]?' on':'');
  b.title='Negar esta variable';
  b.textContent='¬';
  b.onclick=()=>{ negL[pi][li]=!negL[pi][li]; b.classList.toggle('on',negL[pi][li]); updatePreview(); clearResult(); };
  const l=document.createElement('span'); l.className='ll'; l.textContent=BASE[li];
  w.appendChild(b); w.appendChild(l); return w;
}

function makeOp(pi,oi,isMain){
  const w=document.createElement('div'); w.className=isMain?'ow-main':'ow';
  const s=document.createElement('select'); s.className=isMain?'osel-main':'osel';
  OPTS.forEach(op=>{ const o=document.createElement('option'); o.value=op; o.textContent=op; if(op===ops[pi][oi]) o.selected=true; s.appendChild(o); });
  s.onchange=()=>{ ops[pi][oi]=s.value; updatePreview(); clearResult(); };
  w.appendChild(s); return w;
}

// ── Preview ──────────────────────────────────────────────────────────────────
function litH(pi,li){
  return (negL[pi][li]?`<span class="pv-n">¬</span>`:'')+`<span class="pv-v">${BASE[li]}</span>`;
}
function litP(pi,li){ return (negL[pi][li]?'¬':'')+BASE[li]; }
function opH(pi,oi){ return `<span class="pv-o"> ${ops[pi][oi]} </span>`; }
function opP(pi,oi){ return ` ${ops[pi][oi]} `; }
function par(t,html){ return html?`<span class="pv-p">${t}</span>`:t; }
function gnH(pi,gi,inner){ return negG[pi][gi]?`<span class="pv-gn">¬</span>`+inner:inner; }
function gnP(pi,gi,inner){ return negG[pi][gi]?'¬'+inner:inner; }

function buildFH(p){
  const pi=p-1;
  const g0=par('(',true)+litH(pi,0)+opH(pi,0)+litH(pi,1)+par(')',true);
  const g1=par('(',true)+litH(pi,2)+opH(pi,2)+litH(pi,3)+par(')',true);
  const ng0=gnH(pi,0,g0), ng1=gnH(pi,1,g1);
  let s='';
  if(p===2) s+=par('(',true);
  s+=ng0+opH(pi,1)+ng1;
  if(p===2) s+=par(')',true);
  return s;
}

function buildFP(p){
  const pi=p-1;
  const g0='('+litP(pi,0)+opP(pi,0)+litP(pi,1)+')';
  const g1='('+litP(pi,2)+opP(pi,2)+litP(pi,3)+')';
  const ng0=gnP(pi,0,g0), ng1=gnP(pi,1,g1);
  let s='';
  if(p===2) s+='(';
  s+=ng0+opP(pi,1)+ng1;
  if(p===2) s+=')';
  return s;
}

function updatePreview(){
  document.getElementById('preview').innerHTML=buildFH(curP);
}

// ── Evaluar ──────────────────────────────────────────────────────────────────
function evalRow(p,q,r,pi){
  const vm={p,q,r};
  // Lits
  const lits=[0,1,2,3].map(i=>{ const v=vm[BASE[i]]; return negL[pi][i]?!v:v; });
  // Sub-fórmulas
  const g0val=OPF[ops[pi][0]](lits[0],lits[1]);
  const g1val=OPF[ops[pi][2]](lits[2],lits[3]);
  // Aplicar negación de grupo
  const ng0=negG[pi][0]?!g0val:g0val;
  const ng1=negG[pi][1]?!g1val:g1val;
  // Fórmula completa
  return {lits,g0val,g1val,ng0,ng1,res:OPF[ops[pi][1]](ng0,ng1)};
}

// ── Calcular ──────────────────────────────────────────────────────────────────
function calcular(){
  hideErr();
  const pi=curP-1;
  const vals=[true,false];
  const rows=[];
  let allT=true,allF=true;

  for(const p of vals) for(const q of vals) for(const r of vals){
    const ev=evalRow(p,q,r,pi);
    rows.push({p,q,r,...ev});
    if(!ev.res) allT=false;
    if(ev.res) allF=false;
  }

  // Badge clasificación
  const bw=document.getElementById('bw');
  if(allT) bw.innerHTML='<span class="badge bt">✓ Tautología — siempre verdadera</span>';
  else if(allF) bw.innerHTML='<span class="badge bx">✗ Contradicción — siempre falsa</span>';
  else bw.innerHTML='<span class="badge bc">◈ Contingente — depende de los valores</span>';

  // Encabezados dinámicos
  const g0label=gnP(pi,0,'('+litP(pi,0)+opP(pi,0)+litP(pi,1)+')');
  const g1label=gnP(pi,1,'('+litP(pi,2)+opP(pi,2)+litP(pi,3)+')');
  const fp=buildFP(curP);

  // Columnas intermedias: mostramos lits individuales + grupos
  const tbl=document.getElementById('tbl');
  tbl.innerHTML=`
    <thead><tr>
      <th>p</th><th>q</th><th>r</th>
      <th>${litP(pi,0)}</th><th>${litP(pi,1)}</th>
      <th>${litP(pi,2)}</th><th>${litP(pi,3)}</th>
      <th>${g0label}</th><th>${g1label}</th>
      <th class="thr">${fp}</th>
    </tr></thead>
    <tbody>
    ${rows.map((r,i)=>{
      const sep=(i>0&&rows[i-1].p!==r.p)?' class="rsep"':'';
      const tv=v=>`<span class="${v?'vT':'vF'}">${v?'V':'F'}</span>`;
      return `<tr${sep}>
        <td>${tv(r.p)}</td><td>${tv(r.q)}</td><td>${tv(r.r)}</td>
        <td>${tv(r.lits[0])}</td><td>${tv(r.lits[1])}</td>
        <td>${tv(r.lits[2])}</td><td>${tv(r.lits[3])}</td>
        <td>${tv(r.ng0)}</td><td>${tv(r.ng1)}</td>
        <td class="tdr ${r.res?'vT':'vF'}">${r.res?'V':'F'}</td>
      </tr>`;
    }).join('')}
    </tbody>`;

  const rc=document.getElementById('rc');
  rc.style.display='block';
  rc.scrollIntoView({behavior:'smooth',block:'start'});
}

function showErr(m){ document.getElementById('errt').textContent=m; document.getElementById('err').classList.add('show'); }
function hideErr(){ document.getElementById('err').classList.remove('show'); }
function clearResult(){ document.getElementById('rc').style.display='none'; hideErr(); }

function selectProp(n){
  curP=n;
  document.getElementById('tab1').classList.toggle('active',n===1);
  document.getElementById('tab2').classList.toggle('active',n===2);
  document.getElementById('b1').style.display=n===1?'':'none';
  document.getElementById('b2').style.display=n===2?'':'none';
  clearResult(); updatePreview();
}

renderBoth();
updatePreview();
</script>
</body>
</html>
